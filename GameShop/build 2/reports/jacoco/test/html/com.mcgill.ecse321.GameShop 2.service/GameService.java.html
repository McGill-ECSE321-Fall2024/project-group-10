<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GameShop</a> &gt; <a href="index.source.html" class="el_package">com.mcgill.ecse321.GameShop.service</a> &gt; <span class="el_source">GameService.java</span></div><h1>GameService.java</h1><pre class="source lang-java linenums">package com.mcgill.ecse321.GameShop.service;

import java.util.ArrayList;
import java.beans.Transient;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;

import com.mcgill.ecse321.GameShop.exception.GameShopException;
import com.mcgill.ecse321.GameShop.model.Game;

import com.mcgill.ecse321.GameShop.model.Category;
import com.mcgill.ecse321.GameShop.model.Platform;
import com.mcgill.ecse321.GameShop.model.Game.GameStatus;
import com.mcgill.ecse321.GameShop.repository.CategoryRepository;
import com.mcgill.ecse321.GameShop.repository.GameRepository;
import com.mcgill.ecse321.GameShop.repository.PlatformRepository;

import jakarta.transaction.Transactional;

@Service
<span class="fc" id="L24">public class GameService {</span>
    
    @Autowired
    private GameRepository gameRepository;
    @Autowired
    private CategoryRepository categoryRepository;

    @Autowired
    private PlatformRepository platformRepository;

    public boolean isEmpty(String str){
<span class="fc bfc" id="L35" title="All 4 branches covered.">        return str == null || str.trim().isEmpty();</span>
    }
    
    @Transactional
    public Game createGame(String title, String aDescription, int aPrice, Game.GameStatus aGameStatus, int aStockQuantity, String aPhotoUrl) {
        // if (isEmpty(aPhotoUrl) || isEmpty(title) || isEmpty(aDescription) || aPrice &lt; 0 || aStockQuantity &lt; 0 || aGameStatus == null) {
        //     throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Constructor fields for Game cannot be empty, null, or negative&quot;);
        // }
<span class="fc bfc" id="L43" title="All 2 branches covered.">        if (isEmpty(title)) {</span>
<span class="fc" id="L44">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Title cannot be empty or null&quot;);</span>
        }
<span class="fc bfc" id="L46" title="All 2 branches covered.">        if (isEmpty(aDescription)) {</span>
<span class="fc" id="L47">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Description cannot be empty or null&quot;);</span>
        }
<span class="fc bfc" id="L49" title="All 2 branches covered.">        if (aPrice &lt;= 0) {</span>
<span class="fc" id="L50">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Price cannot be negative or 0&quot;);</span>
        }
<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (aStockQuantity &lt; 0) {</span>
<span class="fc" id="L53">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Stock quantity cannot be negative&quot;);</span>
        }
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (aGameStatus == null) {</span>
<span class="fc" id="L56">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game status cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L58" title="All 2 branches covered.">        if (isEmpty(aPhotoUrl)) {</span>
<span class="fc" id="L59">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Photo URL cannot be empty or null&quot;);</span>
        }
<span class="fc" id="L61">        Game game = new Game(title, aDescription, aPrice, aGameStatus, aStockQuantity, aPhotoUrl);</span>
<span class="fc" id="L62">        gameRepository.save(game);</span>
<span class="fc" id="L63">        return game;</span>
    }

    @Transactional
    public Game findGameById(int game_id) {
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if (game_id &lt;= 0) {</span>
<span class="fc" id="L69">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L71">        Game game = gameRepository.findById(game_id);</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">        if (game == null) {</span>
<span class="fc" id="L73">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Game with ID %d does not exist&quot;, game_id));</span>
        }
<span class="fc" id="L75">        return game;</span>
    }

    @Transactional
    public Iterable&lt;Game&gt; getGamesByTitle(String title) {
<span class="fc bfc" id="L80" title="All 2 branches covered.">        if (isEmpty(title)) {</span>
<span class="fc" id="L81">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Title cannot be empty or null&quot;);</span>
        }
<span class="fc" id="L83">        Iterable&lt;Game&gt; games = gameRepository.findAllByTitle(title);</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">        if (!games.iterator().hasNext()) { // Checks if games list is empty</span>
<span class="fc" id="L85">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Game with title %s does not exist&quot;, title));</span>
        }
<span class="fc" id="L87">        return games;</span>
        // PAST METHOD
        // Iterable&lt;Game&gt; games = this.getAllGames();
        // for (Game game : games) {
        //     if (game.getTitle().equals(title)) {
        //         return games;
        //     }
        // }
        // throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Game with title %s does not exist&quot;, title));
    }

    // @Transactional 
    // public Iterable&lt;Game&gt; getGamesByCategory(Category category){
    //     Iterable&lt;Game&gt; games = this.getAllGames();
    //     List&lt;Game&gt; gamesByCategory = new ArrayList&lt;Game&gt;();
    //     for (Game game : games) {
    //         if (game.getCategories().contains(category)) {
    //             gamesByCategory.add(game);
    //         }
    //     }
    //     return gamesByCategory;
    // }

    // @Transactional
    // public Iterable&lt;Game&gt; getGamesByPlatform(Platform platform) {
    //     Iterable&lt;Game&gt; games = this.getAllGames();
    //     List&lt;Game&gt; gamesByPlatform = new ArrayList&lt;Game&gt;();
    //     for (Game game : games) {
    //         if (game.getPlatforms().contains(platform)) {
    //             gamesByPlatform.add(game);
    //         }
    //     }
    //     return gamesByPlatform;
    // }

    @Transactional
    public Iterable&lt;Game&gt; getGamesByStatus(GameStatus status){
<span class="fc bfc" id="L124" title="All 2 branches covered.">        if(status == null){</span>
<span class="fc" id="L125">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game status cannot be null&quot;);</span>
        }
<span class="fc" id="L127">        Iterable&lt;Game&gt; games = this.getAllGames();</span>
<span class="fc" id="L128">        List&lt;Game&gt; gamesByStatus = new ArrayList&lt;Game&gt;();</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">        for (Game game : games) {</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">            if (game.getGameStatus().equals(status)) {</span>
<span class="fc" id="L131">                gamesByStatus.add(game);</span>
            }
<span class="fc" id="L133">        }</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">        if(gamesByStatus.isEmpty()){</span>
<span class="fc" id="L135">            throw new GameShopException(HttpStatus.NOT_FOUND, &quot;No games with the given status&quot;);</span>
        }
<span class="fc" id="L137">        return gamesByStatus;</span>
    }
    

    @Transactional
    public Iterable&lt;Game&gt; getAllGames() {
<span class="fc" id="L143">        return gameRepository.findAll();</span>
    }

    @Transactional
    public Game updateGameDescription(int game_id, String newDescription) {
<span class="fc bfc" id="L148" title="All 2 branches covered.">        if(isEmpty(newDescription)){</span>
<span class="fc" id="L149">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Description cannot be empty or null&quot;);</span>
        }
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L152">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L154">        Game game = findGameById(game_id);</span>

<span class="fc" id="L156">        game.setDescription(newDescription);</span>
<span class="fc" id="L157">        gameRepository.save(game);</span>
<span class="fc" id="L158">        return game;</span>
    }

    @Transactional
    public Game updateGamePrice(int game_id, int newPrice) {
<span class="fc bfc" id="L163" title="All 2 branches covered.">        if (newPrice &lt;= 0) {</span>
<span class="fc" id="L164">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Price cannot be negative nor null&quot;);</span>
        }
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L167">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L169">        Game game = findGameById(game_id);</span>

<span class="fc" id="L171">        game.setPrice(newPrice);</span>
<span class="fc" id="L172">        gameRepository.save(game);</span>
<span class="fc" id="L173">        return game;</span>
    }

    @Transactional
    public Game updateGameStockQuantity(int game_id, int newStockQuantity) {
<span class="fc bfc" id="L178" title="All 2 branches covered.">        if (newStockQuantity &lt; 0) {</span>
<span class="fc" id="L179">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Stock quantity cannot be negative&quot;);</span>
        }
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L182">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L184">        Game game = findGameById(game_id);</span>

<span class="fc" id="L186">        game.setStockQuantity(newStockQuantity);</span>
<span class="fc" id="L187">        gameRepository.save(game);</span>
<span class="fc" id="L188">        return game;</span>
    }

    @Transactional
    public Game updateGameStatus(int game_id, Game.GameStatus newGameStatus) {
<span class="fc bfc" id="L193" title="All 2 branches covered.">        if (newGameStatus == null) {</span>
<span class="fc" id="L194">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game status cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L197">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L199">        Game game = findGameById(game_id);</span>

<span class="fc" id="L201">        game.setGameStatus(newGameStatus);</span>
<span class="fc" id="L202">        gameRepository.save(game);</span>
<span class="fc" id="L203">        return game;</span>
    }

    @Transactional
    public Game updateGamePhotoUrl(int game_id, String newPhotoUrl) {
<span class="fc bfc" id="L208" title="All 2 branches covered.">        if (isEmpty(newPhotoUrl)) {</span>
<span class="fc" id="L209">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Photo URL cannot be empty or null&quot;);</span>
        }
<span class="pc bpc" id="L211" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L212">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L214">        Game game = findGameById(game_id);</span>

<span class="fc" id="L216">        game.setPhotoUrl(newPhotoUrl);</span>
<span class="fc" id="L217">        gameRepository.save(game);</span>
<span class="fc" id="L218">        return game;</span>
    }

    @Transactional
    public Game updateGameTitle(int game_id, String newTitle) {
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (isEmpty(newTitle)) {</span>
<span class="fc" id="L224">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Title cannot be empty or null&quot;);</span>
        }
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">        if(game_id &lt;= 0){</span>
<span class="nc" id="L227">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L229">        Game game = findGameById(game_id);</span>

<span class="fc" id="L231">        game.setTitle(newTitle);</span>
<span class="fc" id="L232">        gameRepository.save(game);</span>
<span class="fc" id="L233">        return game;</span>
    }

    @Transactional
    public Game updateCategories(int gameId, List&lt;Integer&gt; categories) {
       
<span class="fc bfc" id="L239" title="All 2 branches covered.">        if (categories == null) {</span>
<span class="fc" id="L240">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Categories cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">        if (gameId &lt;= 0) {</span>
<span class="nc" id="L243">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L245">        Game game = findGameById(gameId);</span>
  
<span class="fc bfc" id="L247" title="All 2 branches covered.">        for (int category_id : categories) {</span>
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">            if (category_id &lt;= 0) {</span>
<span class="nc" id="L249">                throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Invalid category ID&quot;);</span>
            }
<span class="fc" id="L251">            Category category = categoryRepository.findById(category_id);</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">            if (category == null) {</span>
<span class="fc" id="L253">                throw new GameShopException(HttpStatus.NOT_FOUND,&quot;Category does not exist&quot;);</span>
            }
<span class="fc bfc" id="L255" title="All 2 branches covered.">            if (!game.getCategories().contains(category)) {</span>
<span class="fc" id="L256">                game.addCategory(category);</span>
            }
       
          
<span class="fc" id="L260">        }</span>
      
<span class="fc" id="L262">        gameRepository.save(game);</span>
<span class="fc" id="L263">        return game;</span>
    }

    @Transactional
    public Game updatePlatforms(int gameId, List&lt;Integer&gt; platforms) {
<span class="fc bfc" id="L268" title="All 2 branches covered.">        if (platforms == null) {</span>
<span class="fc" id="L269">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Platforms cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L271" title="1 of 2 branches missed.">        if (gameId &lt;= 0) {</span>
<span class="nc" id="L272">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L274">        Game game = findGameById(gameId);</span>
<span class="fc bfc" id="L275" title="All 2 branches covered.">        for (int platform_id : platforms) {</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">            if (platform_id &lt;= 0) {</span>
<span class="nc" id="L277">                throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Platform ID must be greater than 0&quot;);</span>
            }
<span class="fc" id="L279">            Platform platform = platformRepository.findById(platform_id);</span>
<span class="fc bfc" id="L280" title="All 2 branches covered.">            if (platform == null) {</span>
<span class="fc" id="L281">                throw new GameShopException(HttpStatus.NOT_FOUND, &quot;Platform does not exist&quot;);</span>
            }
<span class="fc bfc" id="L283" title="All 2 branches covered.">            if(!game.getPlatforms().contains(platform)){</span>
<span class="fc" id="L284">                game.addPlatform(platform);</span>
            }

<span class="fc" id="L287">        }</span>
<span class="fc" id="L288">        gameRepository.save(game);</span>
<span class="fc" id="L289">        return game;</span>
    }
    
    @Transactional 
    public void deleteGame(int game_id) {
<span class="fc" id="L294">        Game game = findGameById(game_id);</span>
<span class="fc" id="L295">        gameRepository.delete(game);</span>

<span class="fc" id="L297">    }</span>

    @Transactional
    public Game addCategory(int game_id, int category_id) {
<span class="fc bfc" id="L301" title="All 2 branches covered.">        if(game_id &lt;= 0){</span>
<span class="fc" id="L302">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc bfc" id="L304" title="All 2 branches covered.">        if(category_id &lt;= 0){</span>
<span class="fc" id="L305">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Category ID must be greater than 0&quot;);</span>
        }
<span class="fc" id="L307">        Game game = findGameById(game_id);</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">        if (game == null) {</span>
<span class="nc" id="L309">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Game with ID %d does not exist&quot;, game_id));</span>
        }

<span class="fc" id="L312">        Category category = categoryRepository.findById(category_id);</span>
<span class="fc bfc" id="L313" title="All 2 branches covered.">        if (category == null) {</span>
<span class="fc" id="L314">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Category with ID %d does not exist&quot;, category_id));</span>
        }
<span class="fc bfc" id="L316" title="All 2 branches covered.">        if (game.getCategories().contains(category)) {</span>
<span class="fc" id="L317">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Category is already in the game&quot;);</span>
        }
<span class="fc" id="L319">         game.addCategory(category);</span>
<span class="fc" id="L320">         gameRepository.save(game);</span>
<span class="fc" id="L321">         return game;</span>
    }

    @Transactional
    public Game addPlatform(int game_id, int platform_id) {
<span class="fc bfc" id="L326" title="All 2 branches covered.">        if(game_id &lt;= 0){</span>
<span class="fc" id="L327">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Game ID must be greater than 0&quot;);</span>
        }
<span class="fc bfc" id="L329" title="All 2 branches covered.">        if(platform_id &lt;= 0){</span>
<span class="fc" id="L330">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Platform ID must be greater than 0&quot;);</span>
        }

<span class="fc" id="L333">        Game game = findGameById(game_id);</span>
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">        if(game == null){</span>
<span class="nc" id="L335">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Game with ID %d does not exist&quot;, game_id));</span>
        }
<span class="fc" id="L337">        Platform platform = platformRepository.findById(platform_id);</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">        if(platform == null){</span>
<span class="fc" id="L339">            throw new GameShopException(HttpStatus.NOT_FOUND, String.format(&quot;Platform with ID %d does not exist&quot;, platform_id));</span>
        }
<span class="fc bfc" id="L341" title="All 2 branches covered.">        if (game.getPlatforms().contains(platform)) {</span>
<span class="fc" id="L342">            throw new GameShopException(HttpStatus.BAD_REQUEST, &quot;Platform is already in the game&quot;);</span>
        }
<span class="fc" id="L344">        game.addPlatform(platform);</span>
<span class="fc" id="L345">        gameRepository.save(game);</span>
<span class="fc" id="L346">        return game;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>