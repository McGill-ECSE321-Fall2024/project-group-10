<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AccountService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GameShop</a> &gt; <a href="index.source.html" class="el_package">com.mcgill.ecse321.GameShop.service</a> &gt; <span class="el_source">AccountService.java</span></div><h1>AccountService.java</h1><pre class="source lang-java linenums">package com.mcgill.ecse321.GameShop.service;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;

import com.mcgill.ecse321.GameShop.exception.GameShopException;
import com.mcgill.ecse321.GameShop.model.Account;
import com.mcgill.ecse321.GameShop.model.Cart;
import com.mcgill.ecse321.GameShop.model.Customer;
import com.mcgill.ecse321.GameShop.model.Employee;
import com.mcgill.ecse321.GameShop.model.Manager;
import com.mcgill.ecse321.GameShop.model.WishList;
import com.mcgill.ecse321.GameShop.model.Employee.EmployeeStatus;
import com.mcgill.ecse321.GameShop.repository.AccountRepository;
import com.mcgill.ecse321.GameShop.repository.CartRepository;
import com.mcgill.ecse321.GameShop.repository.CustomerRepository;
import com.mcgill.ecse321.GameShop.repository.EmployeeRepository;
import com.mcgill.ecse321.GameShop.repository.ManagerRepository;
import com.mcgill.ecse321.GameShop.repository.WishListRepository;

import jakarta.transaction.Transactional;

@Service
<span class="fc" id="L26">public class AccountService {</span>
    
    @Autowired
    private ManagerRepository managerRepo;

    @Autowired
    private EmployeeRepository employeeRepo;

    @Autowired
    private CustomerRepository customerRepo;

    @Autowired
    private CartRepository cartRepository;
    
    @Autowired
    private WishListRepository wishListRepository;

    @Autowired
    private AccountRepository accountRepository;



    @Transactional
    public Manager createManager(String email, String username, String password, String phoneNumber, String address){
        //check that only one manager can be created
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">        if (managerRepo.count() &gt; 1){</span>
<span class="nc" id="L52">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L53">            String.format(&quot;A manager already exists&quot;));</span>
        }

        //input validation to ensure email, username, and password are not null
<span class="pc bpc" id="L57" title="2 of 4 branches missed.">        if (email.trim().isEmpty() || email == null){</span>
<span class="nc" id="L58">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L59">					String.format(&quot;Email is invalid&quot;));</span>
        }
<span class="pc bpc" id="L61" title="2 of 4 branches missed.">        if (username.trim().isEmpty() || username == null){</span>
<span class="nc" id="L62">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L63">            String.format(&quot;Invalid username %s&quot;, username));</span>
        }
<span class="pc bpc" id="L65" title="2 of 4 branches missed.">        if (password.trim().isEmpty() || password == null){</span>
<span class="nc" id="L66">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L67">            String.format(&quot;Invalid password&quot;));</span>
        }
        //find the account using the email to check if an account with that email exists
<span class="fc" id="L70">        Account account = accountRepository.findByEmail(email);</span>
        
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">        if (account != null){</span>
<span class="nc" id="L73">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L74">					String.format(&quot;Account with email %s already exists.&quot;, email));</span>
        }

        //if email is valid create the manager
<span class="fc" id="L78">        Manager manager = new Manager(email, username, password, phoneNumber, address);</span>
<span class="fc" id="L79">        return managerRepo.save(manager);</span>
    }

    @Transactional
    public Employee createEmployee(String email, String username, String password, String phoneNumber, String address){
        //input validation
<span class="pc bpc" id="L85" title="2 of 4 branches missed.">        if (email.trim().isEmpty() || email == null){</span>
<span class="nc" id="L86">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L87">					String.format(&quot;Email is invalid&quot;));</span>
        }
<span class="pc bpc" id="L89" title="2 of 4 branches missed.">        if (username.trim().isEmpty() || username == null){</span>
<span class="nc" id="L90">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L91">            String.format(&quot;Invalid username %s&quot;, username));</span>
        }
<span class="pc bpc" id="L93" title="2 of 4 branches missed.">        if (password.trim().isEmpty() || password == null){</span>
<span class="nc" id="L94">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L95">            String.format(&quot;Invalid password&quot;));</span>
        }

        //check to see if the email already exists in the system
<span class="fc" id="L99">        Account account = accountRepository.findByEmail(email);</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">        if (account != null){</span>
<span class="nc" id="L101">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L102">					String.format(&quot;Account with email %s already exists.&quot;, email));</span>
        }

        //if email does not exist, create a new employee
<span class="fc" id="L106">        Employee employee = new Employee(email, username, password, phoneNumber, address);</span>
<span class="fc" id="L107">        return employeeRepo.save(employee);</span>
    }

    @Transactional
    public Customer createCustomer(String email, String username, String password, String phoneNumber, String address){
        //input validation
<span class="pc bpc" id="L113" title="2 of 4 branches missed.">        if (email.trim().isEmpty() || email == null){</span>
<span class="nc" id="L114">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L115">					String.format(&quot;Email is invalid&quot;));</span>
        }
<span class="pc bpc" id="L117" title="2 of 4 branches missed.">        if (username.trim().isEmpty() || username == null){</span>
<span class="nc" id="L118">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L119">            String.format(&quot;Invalid username %s&quot;, username));</span>
        }
<span class="pc bpc" id="L121" title="2 of 4 branches missed.">        if (password.trim().isEmpty() || password == null){</span>
<span class="nc" id="L122">            throw new GameShopException(HttpStatus.BAD_REQUEST,</span>
<span class="nc" id="L123">            String.format(&quot;Invalid password&quot;));</span>
        }

        //check if the account already exists
<span class="fc" id="L127">        Account account = accountRepository.findByEmail(email);</span>
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">        if (account != null){</span>
<span class="nc" id="L129">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L130">            String.format(&quot;Account with email %s already exists.&quot;, email));</span>
        }

        //a cart is mandatory when creating a customer
<span class="fc" id="L134">        Cart cart = new Cart();</span>
<span class="fc" id="L135">        cartRepository.save(cart);</span>

        //create the customer
<span class="fc" id="L138">        Customer customer = new Customer(email, username, password, phoneNumber, address, cart);</span>
<span class="fc" id="L139">        Customer savedCustomer = customerRepo.save(customer);</span>
<span class="fc" id="L140">        WishList wishList = new WishList(&quot;customer&quot;, savedCustomer);</span>
<span class="fc" id="L141">        wishListRepository.save(wishList);</span>
<span class="fc" id="L142">        return savedCustomer;</span>
    }



    @Transactional
    public Iterable&lt;Account&gt; getAllEmployees(){
<span class="fc" id="L149">        return employeeRepo.findAll();</span>
    }


    @Transactional
    public Iterable&lt;Account&gt; getAllCustomers(){
<span class="fc" id="L155">        return customerRepo.findAll();</span>
    }

    @Transactional
    public Iterable&lt;Account&gt; getManager(){
<span class="fc" id="L160">        return managerRepo.findAll();</span>
    }


    @Transactional
    public Account updateAccount(String email, String username, String password, String phoneNumber, String address){
<span class="fc" id="L166">        Account account = getAccountByEmail(email);</span>
        //ensure that the account exists
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">        if (account!= null){</span>
<span class="fc" id="L169">            account.setUsername(username);</span>
<span class="fc" id="L170">            account.setPassword(password);</span>
<span class="fc" id="L171">            account.setPhoneNumber(phoneNumber);</span>
<span class="fc" id="L172">            account.setAddress(address);</span>
        } else{
<span class="nc" id="L174">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L175">            String.format(&quot;Account with email %s does not exist.&quot;, email));</span>
        }
        
<span class="fc" id="L178">        return accountRepository.save(account);</span>
    }

    @Transactional
    public Account getAccountByEmail(String email){
        //ensure the account exists
<span class="fc" id="L184">        Account account = accountRepository.findByEmail(email);</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">        if (account == null) {</span>
<span class="nc" id="L186">			throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L187">					String.format(&quot;There is no account with email %s.&quot;, email));</span>
		}
<span class="fc" id="L189">		return account;</span>
    }

    @Transactional
    public Employee getEmployeeAccountByEmail(String email){
        //ensure the employee account exists
<span class="fc" id="L195">        Employee account = employeeRepo.findByEmail(email);</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">        if (account == null) {</span>
<span class="nc" id="L197">			throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L198">					String.format(&quot;There is no employee account with email %s.&quot;, email));</span>
		}
<span class="fc" id="L200">		return account;</span>
    }

    @Transactional
    public Customer getCustomerAccountByEmail(String email){
        //ensure the customer account exists
<span class="fc" id="L206">        Customer account = customerRepo.findByEmail(email);</span>
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        if (account == null) {</span>
<span class="nc" id="L208">			throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L209">					String.format(&quot;There is no customer account with email %s.&quot;, email));</span>
		}
<span class="fc" id="L211">		return account;</span>
    }

    @Transactional
    public Employee archiveEmployee(String email){
        //find the employee account using the email
<span class="fc" id="L217">        Employee employee = employeeRepo.findByEmail(email);</span>
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">        if (employee != null){</span>
            //set the status of the employee to archived
<span class="fc" id="L220">            employee.setEmployeeStatus(EmployeeStatus.Archived);</span>
<span class="fc" id="L221">            return employeeRepo.save(employee);</span>
        }else{
<span class="nc" id="L223">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L224">            String.format(&quot;Account with email %s does not exist.&quot;, email));</span>
        }
    }

    @Transactional
    public WishList getWishlistByCustomerEmail(String email){
        //find the customer account using the email
<span class="fc" id="L231">        Customer customer = customerRepo.findByEmail(email);</span>
<span class="fc" id="L232">        WishList wishlistToReturn = null;</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">        if (customer == null){</span>
<span class="nc" id="L234">            throw new GameShopException(HttpStatus.NOT_FOUND,</span>
<span class="nc" id="L235">            String.format(&quot;Account with email %s does not exist.&quot;, email));</span>
        } else{
<span class="fc" id="L237">            Iterable&lt;WishList&gt; wishlists = wishListRepository.findAll();</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">            for (WishList wishlist: wishlists){</span>
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">            if (wishlist.getCustomer().getEmail().equals(email)){</span>
<span class="fc" id="L240">                wishlistToReturn = wishlist;</span>
            }
<span class="fc" id="L242">        }</span>
        }
<span class="fc" id="L244">                return wishlistToReturn;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>